groups:
- name: docker-alerts
  rules:
  - alert: DockerContainerDown
    expr: |
      count by (name) (
        container_tasks_state{state="running"}
      ) == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Container {{ $labels.name }} is DOWN"
      description: "Docker container {{ $labels.name }} is not running for more than 1 minute."

- name: disk-alerts
  rules:

  - alert: DiskSpaceLow
    expr: |
      (
        node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"} 
        /
        node_filesystem_size_bytes{fstype!~"tmpfs|overlay"}
      ) < 0.15
      and
      node_filesystem_readonly == 0
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "Low disk space on {{ $labels.instance }}"
      description: "Disk space below 15% on mount {{ $labels.mountpoint }}."


- name: memory-alerts
  rules:

  - alert: HighMemoryUsage
    expr: |
      (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) > 0.85
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "High memory usage on {{ $labels.instance }}"
      description: "Memory usage is above 85% for more than 2 minutes."
